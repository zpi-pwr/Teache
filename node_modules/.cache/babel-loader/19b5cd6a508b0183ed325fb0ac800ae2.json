{"ast":null,"code":"import _classCallCheck from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _taggedTemplateLiteral from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/src/components/MainPage.js\";\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    position: absolute;\\n    top: 5%;\\n    left: 50%;\\n    width: 90%;\\n    height: 80%;\\n    transform: translate(-50%);\\n    display: grid;\\n    grid-gap: 4px;\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { Component } from \"react\";\nimport ChatGroup from './ChatGroup';\nimport bgPic from \"../assets/mntnFHD_compressed_cut.jpeg\";\nimport Message from './Message';\nimport { connect } from \"react-redux\";\nimport GroupsComponent from \"./GroupsComponent\";\nimport ChatComponent from \"./ChatComponent\";\nimport styled from 'styled-components';\nimport { DetailsComponent } from \"./DetailsComponent\";\nimport '../styles/mainPage.scss';\nimport { Messages } from \"../data/Messages\";\nimport { Mutation, Query } from 'react-apollo';\nimport gql from 'graphql-tag';\nimport AdvertsComponent from \"./AdvertsComponent\";\nimport MetamaskComponent from \"../components/MetamaskComponent\"; // const Page = styled.div`\n//     // width: 100%;\n//     // height: 910px;\n//     // background-image: url(${bgPic})\n//     `;\n\nvar Container = styled.div(_templateObject());\nvar styleOptCollapsed = {\n  gridTemplateColumns: '72px auto' // gridTemplateRows: '95%',\n\n};\nvar styleOptUnCollapsed = {\n  gridTemplateColumns: '72px auto 320px' // gridTemplateRows: '95%',\n\n};\n\nvar MainPage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(MainPage, _Component);\n\n  function MainPage(props) {\n    var _this;\n\n    _classCallCheck(this, MainPage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(MainPage).call(this, props));\n\n    _this.handleKeyPress = function (event) {\n      if (event.key === 'Enter') {\n        _this.handleSend();\n      }\n    };\n\n    _this.metamaskClick = function (event) {\n      _this.setState({\n        showMetamaskDialog: false\n      });\n    };\n\n    _this.showDialog = function (event) {\n      _this.setState({\n        showMetamaskDialog: true\n      });\n    };\n\n    _this.openMainItem = function () {\n      _this.setState({\n        mainItemActive: true,\n        activeConversation: null\n      });\n\n      console.log(\"Open Main Item\");\n    };\n\n    _this.groupChanged = function (id) {\n      console.log(\"group changed: \", id);\n\n      _this.setState({\n        activeConversation: id,\n        mainItemActive: false\n      });\n    };\n\n    _this.showDetails = function (id) {\n      console.log(id);\n    };\n\n    _this.findActive = function (conversation) {\n      var activeConversation = _this.state.activeConversation;\n      return conversation.id === activeConversation;\n    };\n\n    var _this$props = _this.props,\n        conversations = _this$props.conversations,\n        groups = _this$props.groups,\n        adverts = _this$props.adverts;\n    console.log(_this.props);\n    _this.state = {\n      inputMessage: '',\n      activeConversation: conversations[0].id,\n      conversations: conversations,\n      groups: groups,\n      mainItemActive: true,\n      width: 0,\n      isCollapsed: false,\n      userID: '5ca1c9a11c9d4400003e3590',\n      showMetamaskDialog: false\n    };\n    _this.updateWindowDimensions = _this.updateWindowDimensions.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(MainPage, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.updateWindowDimensions();\n      window.addEventListener('resize', this.updateWindowDimensions);\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      window.removeEventListener('resize', this.updateWindowDimensions);\n    }\n  }, {\n    key: \"updateWindowDimensions\",\n    value: function updateWindowDimensions() {\n      var w = window.innerWidth;\n      this.setState({\n        width: w,\n        isCollapsed: w <= 960\n      });\n    }\n  }, {\n    key: \"handleSend\",\n    value: function handleSend() {\n      var inputMessage = this.state.inputMessage;\n\n      if (inputMessage) {\n        console.log('send message');\n        this.setState(function (prevState) {\n          prevState.inputMessage = '';\n          return prevState;\n        });\n      }\n\n      console.log(\"sending message\");\n      fetch('http://localhost:4050/graphql', {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          query: \"mutation($message: MessageInput!){ addMessage(message: $message){ content id } } \",\n          variables: \"{\\\"message\\\": {\\\"id_conversation\\\": \\\"5ca3a1ef1cbb8b36dbb6adf0\\\", \\\"id_sender\\\": \\\"\".concat(this.state.userID, \"\\\", \\\"content\\\": \\\"\").concat(inputMessage, \"\\\"}}\")\n        })\n      }); // `{ \"message\": { \"id_conversation\": \"5ca387903805a07cd4526d77\", \"id_sender\": \"${this.state.userID}\", \"content\": \"XD\" } }`\n\n      {\n        /*<Mutation mutation={gql`*/\n      }\n      {\n        /*        mutation ($content:String!,$id_conv:String!,$id_sender:String!){*/\n      }\n      {\n        /*          sendMessage(content: $content, id_conversation: $id_conv, id_sender: $id_sender) {*/\n      }\n      {\n        /*            id*/\n      }\n      {\n        /*          }*/\n      }\n      {\n        /*        }`*/\n      }\n      {\n        /*}>*/\n      }\n      {\n        /*    {(sendMessage, {data}) => (*/\n      }\n      {\n        /*        sendMessage({*/\n      }\n      {\n        /*                variables: {*/\n      }\n      {\n        /*                    content: \"inputMessage\",*/\n      }\n      {\n        /*                    id_sender: \"this.state.userID\",*/\n      }\n      {\n        /*                    id_conv: '5c98f6721c9d440000626e2e'*/\n      }\n      {\n        /*                }*/\n      }\n      {\n        /*            }*/\n      }\n      {\n        /*        )*/\n      }\n      {\n        /*    )}*/\n      }\n      {}\n      /*</Mutation>*/\n      // mutation\n      // sendMessage(\n      //     content: \"A dziękuję\",\n      //     id_conversation: \"5c98f6721c9d440000626e2e\",\n      //     id_sender: \"5ca1c9a11c9d4400003e3590\") {\n      //     content\n      // }\n    }\n  }, {\n    key: \"handleChangeInput\",\n    value: function handleChangeInput(event) {\n      var value = event.target.value;\n      this.setState({\n        inputMessage: value\n      });\n      console.log(\"input\");\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state = this.state,\n          conversations = _this$state.conversations,\n          userID = _this$state.userID,\n          groups = _this$state.groups,\n          activeConversation = _this$state.activeConversation,\n          isCollapsed = _this$state.isCollapsed,\n          mainItemActive = _this$state.mainItemActive,\n          inputMessage = _this$state.inputMessage;\n      var activeConvName = mainItemActive ? [] : conversations.find(this.findActive).name;\n      var messagesList = conversations.length !== 0 && conversations.find(this.findActive) ? conversations.find(this.findActive).messages.map(function (message) {\n        return React.createElement(Message, {\n          message: message.inputMessage,\n          id: message.id,\n          key: message.id,\n          handleOver: _this2.showDetails // isActive={message.id_sender === userID}\n          ,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 218\n          },\n          __self: this\n        });\n      }) : [];\n      var groupsCompList = groups.map(function (chat) {\n        return React.createElement(ChatGroup, {\n          key: chat.id,\n          id: chat.id,\n          url: chat.avatar,\n          onClick: _this2.groupChanged,\n          active: chat.id === activeConversation,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 229\n          },\n          __self: this\n        });\n      });\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, React.createElement(MetamaskComponent, {\n        show: true,\n        onChange: this.metamaskClick,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 238\n        },\n        __self: this\n      }), React.createElement(Container, {\n        style: isCollapsed ? styleOptCollapsed : styleOptUnCollapsed,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 239\n        },\n        __self: this\n      }, React.createElement(GroupsComponent, {\n        mainItemActive: mainItemActive,\n        openMainItem: this.openMainItem,\n        list: groupsCompList,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 241\n        },\n        __self: this\n      }), this.state.mainItemActive ? React.createElement(AdvertsComponent, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 247\n        },\n        __self: this\n      }) : React.createElement(ChatComponent, {\n        handleOver: this.showDetails,\n        userId: userID,\n        conversationName: activeConvName,\n        messages: messagesList,\n        inputMessage: inputMessage,\n        onChange: function onChange(event) {\n          return _this2.handleChangeInput(event);\n        },\n        onKeyPress: this.handleKeyPress,\n        onClick: function onClick() {\n          return _this2.handleSend();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 248\n        },\n        __self: this\n      }), !isCollapsed ? React.createElement(DetailsComponent, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 258\n        },\n        __self: this\n      }) : null), React.createElement(\"button\", {\n        onclick: this.showDialog,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 260\n        },\n        __self: this\n      }, \"Show dialog!\"));\n    }\n  }]);\n\n  return MainPage;\n}(Component);\n\nfunction mapStateToProps(state) {\n  var _state$chatReducer = state.chatReducer,\n      conversations = _state$chatReducer.conversations,\n      groups = _state$chatReducer.groups;\n  var adverts = state.advertReducer.adverts;\n  return {\n    conversations: conversations,\n    groups: groups,\n    adverts: adverts\n  };\n}\n\nexport default MainPage = connect(mapStateToProps)(MainPage);","map":{"version":3,"sources":["/home/przemek/Data/Programowanie/PWr/ZPI/frontend/src/components/MainPage.js"],"names":["React","Component","ChatGroup","bgPic","Message","connect","GroupsComponent","ChatComponent","styled","DetailsComponent","Messages","Mutation","Query","gql","AdvertsComponent","MetamaskComponent","Container","div","styleOptCollapsed","gridTemplateColumns","styleOptUnCollapsed","MainPage","props","handleKeyPress","event","key","handleSend","metamaskClick","setState","showMetamaskDialog","showDialog","openMainItem","mainItemActive","activeConversation","console","log","groupChanged","id","showDetails","findActive","conversation","state","conversations","groups","adverts","inputMessage","width","isCollapsed","userID","updateWindowDimensions","bind","window","addEventListener","removeEventListener","w","innerWidth","prevState","fetch","method","headers","body","JSON","stringify","query","variables","value","target","activeConvName","find","name","messagesList","length","messages","map","message","groupsCompList","chat","avatar","handleChangeInput","mapStateToProps","chatReducer","advertReducer"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\"\nimport ChatGroup from './ChatGroup'\nimport bgPic from \"../assets/mntnFHD_compressed_cut.jpeg\";\nimport Message from './Message'\n\nimport {connect} from \"react-redux\";\nimport GroupsComponent from \"./GroupsComponent\";\nimport ChatComponent from \"./ChatComponent\";\nimport styled from 'styled-components'\nimport {DetailsComponent} from \"./DetailsComponent\";\nimport '../styles/mainPage.scss'\nimport {Messages} from \"../data/Messages\";\nimport {Mutation, Query} from 'react-apollo'\nimport gql from 'graphql-tag'\nimport AdvertsComponent from \"./AdvertsComponent\";\nimport MetamaskComponent from \"../components/MetamaskComponent\"\n\n// const Page = styled.div`\n//     // width: 100%;\n//     // height: 910px;\n//     // background-image: url(${bgPic})\n//     `;\n\nconst Container = styled.div`\n    position: absolute;\n    top: 5%;\n    left: 50%;\n    width: 90%;\n    height: 80%;\n    transform: translate(-50%);\n    display: grid;\n    grid-gap: 4px;`;\n\nconst styleOptCollapsed = {\n    gridTemplateColumns: '72px auto',\n    // gridTemplateRows: '95%',\n};\n\nconst styleOptUnCollapsed = {\n    gridTemplateColumns: '72px auto 320px',\n    // gridTemplateRows: '95%',\n};\n\nclass MainPage extends Component {\n\n    constructor(props) {\n        super(props);\n        const {conversations, groups, adverts} = this.props;\n        console.log(this.props);\n        this.state = {\n            inputMessage: '',\n            activeConversation: conversations[0].id,\n            conversations: conversations,\n            groups: groups,\n            mainItemActive: true,\n            width: 0,\n            isCollapsed: false,\n            userID: '5ca1c9a11c9d4400003e3590',\n            showMetamaskDialog: false\n        };\n        this.updateWindowDimensions = this.updateWindowDimensions.bind(this);\n    }\n\n    componentDidMount() {\n        this.updateWindowDimensions();\n        window.addEventListener('resize', this.updateWindowDimensions)\n    }\n\n    componentWillMount() {\n        window.removeEventListener('resize', this.updateWindowDimensions)\n    }\n\n    updateWindowDimensions() {\n        const w = window.innerWidth;\n        this.setState({\n            width: w,\n            isCollapsed: w <= 960\n        });\n    }\n\n    handleSend() {\n        const {inputMessage} = this.state;\n        if (inputMessage) {\n            console.log('send message');\n            this.setState(prevState => {\n                prevState.inputMessage = '';\n                return prevState\n            });\n        }\n        console.log(\"sending message\");\n        fetch('http://localhost:4050/graphql', {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                query: `mutation($message: MessageInput!){ addMessage(message: $message){ content id } } `,\n                variables: `{\"message\": {\"id_conversation\": \"5ca3a1ef1cbb8b36dbb6adf0\", \"id_sender\": \"${this.state.userID}\", \"content\": \"${inputMessage}\"}}`\n            })\n        });\n        // `{ \"message\": { \"id_conversation\": \"5ca387903805a07cd4526d77\", \"id_sender\": \"${this.state.userID}\", \"content\": \"XD\" } }`\n\n\n        {/*<Mutation mutation={gql`*/\n        }\n        {/*        mutation ($content:String!,$id_conv:String!,$id_sender:String!){*/\n        }\n        {/*          sendMessage(content: $content, id_conversation: $id_conv, id_sender: $id_sender) {*/\n        }\n        {/*            id*/\n        }\n        {/*          }*/\n        }\n        {/*        }`*/\n        }\n        {/*}>*/\n        }\n        {/*    {(sendMessage, {data}) => (*/\n        }\n        {/*        sendMessage({*/\n        }\n        {/*                variables: {*/\n        }\n        {/*                    content: \"inputMessage\",*/\n        }\n        {/*                    id_sender: \"this.state.userID\",*/\n        }\n        {/*                    id_conv: '5c98f6721c9d440000626e2e'*/\n        }\n        {/*                }*/\n        }\n        {/*            }*/\n        }\n        {/*        )*/\n        }\n        {/*    )}*/\n        }\n        {/*</Mutation>*/\n        }\n\n        // mutation\n        // sendMessage(\n        //     content: \"A dziękuję\",\n        //     id_conversation: \"5c98f6721c9d440000626e2e\",\n        //     id_sender: \"5ca1c9a11c9d4400003e3590\") {\n        //     content\n        // }\n\n    }\n\n    handleKeyPress = (event) => {\n        if (event.key === 'Enter') {\n            this.handleSend();\n        }\n    };\n\n    handleChangeInput(event) {\n        const {value} = event.target;\n        this.setState({\n            inputMessage: value\n        });\n        console.log(\"input\")\n    }\n\n    metamaskClick = (event) => {\n        this.setState({\n            showMetamaskDialog: false\n        })\n    }\n\n    showDialog = (event) => {\n        this.setState({\n            showMetamaskDialog: true\n        })\n    }\n\n    openMainItem = () => {\n        this.setState({\n            mainItemActive: true,\n            activeConversation: null\n        });\n        console.log(\"Open Main Item\")\n    };\n\n\n    groupChanged = (id) => {\n        console.log(\"group changed: \", id);\n        this.setState({\n            activeConversation: id,\n            mainItemActive: false\n        });\n    };\n\n    showDetails = (id) => {\n        console.log(id);\n    };\n\n    findActive = (conversation) => {\n        const {activeConversation} = this.state;\n        return conversation.id === activeConversation\n    };\n\n    render() {\n        const {\n            conversations,\n            userID,\n            groups,\n            activeConversation,\n            isCollapsed,\n            mainItemActive,\n            inputMessage,\n        } = this.state;\n\n        const activeConvName = mainItemActive ? [] : conversations.find(this.findActive).name;\n\n        const messagesList = conversations.length !== 0 && conversations.find(this.findActive)\n            ? conversations.find(this.findActive).messages.map(message =>\n                <Message\n                    message={message.inputMessage}\n                    id={message.id}\n                    key={message.id}\n                    handleOver={this.showDetails}\n                    // isActive={message.id_sender === userID}\n                />)\n            : [];\n\n        const groupsCompList =\n            groups.map(chat =>\n                <ChatGroup\n                    key={chat.id}\n                    id={chat.id}\n                    url={chat.avatar}\n                    onClick={this.groupChanged}\n                    active={chat.id === activeConversation}/>);\n\n        return (\n            <div>\n                <MetamaskComponent show={true} onChange={this.metamaskClick}></MetamaskComponent>\n                <Container\n                    style={isCollapsed ? styleOptCollapsed : styleOptUnCollapsed}>\n                    <GroupsComponent\n                        mainItemActive={mainItemActive}\n                        openMainItem={this.openMainItem}\n                        list={groupsCompList}/>\n                {/**/}\n                    {this.state.mainItemActive\n                        ? <AdvertsComponent />\n                        : <ChatComponent\n                        handleOver={this.showDetails}\n                        userId={userID}\n                        conversationName={activeConvName}\n                        messages={messagesList}\n                        inputMessage={inputMessage}\n                        onChange={event => this.handleChangeInput(event)}\n                        onKeyPress={this.handleKeyPress}\n                        onClick={() => this.handleSend()}/>\n                    }\n                    {!isCollapsed ? <DetailsComponent/> : null}\n                </Container>\n                <button onclick={this.showDialog}>Show dialog!</button>\n            </div>\n        )\n    }\n}\n\nfunction mapStateToProps(state) {\n    const {conversations, groups} = state.chatReducer;\n    const {adverts} = state.advertReducer;\n    return {conversations, groups, adverts};\n}\n\nexport default MainPage = connect(mapStateToProps)(MainPage);\n"]},"metadata":{},"sourceType":"module"}