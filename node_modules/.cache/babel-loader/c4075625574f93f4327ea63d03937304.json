{"ast":null,"code":"import { TOKEN_EXPRESS, TOKEN_SPRING } from \"../constraints\";\nimport Alert from \"react-s-alert\";\nimport { restConstants } from \"../constraints/restConstants\";\nexport var userService = {\n  login: login,\n  register: register,\n  logout: logout\n};\n\nfunction login(email, password) {\n  if (localStorage.getItem(TOKEN_SPRING)) return;\n  var body = {\n    email: email,\n    password: password\n  };\n  return function (dispatch) {\n    fetch(\"http://localhost:8080/api/auth/login\", {\n      method: \"post\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(body)\n    }).then(function (data) {\n      return data.json();\n    }).then(function (response) {\n      console.log('UserService login: ');\n      console.log(response);\n      localStorage.setItem(TOKEN_SPRING, response.accessToken);\n      return dispatch(getUserInfo(email, password));\n    });\n  };\n}\n\nfunction register(body) {\n  if (localStorage.getItem(TOKEN_SPRING)) return null;\n  return function (dispatch) {\n    fetch(\"http://localhost:8080/api/auth/signup\", {\n      method: \"post\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(body)\n    }).then(function (data) {\n      return data.json();\n    }).then(function (response) {\n      console.log('UserService register: ');\n      console.log(response);\n    });\n  };\n}\n\nfunction getUserInfo(email, password) {\n  if (!localStorage.getItem(TOKEN_SPRING) || localStorage.getItem(TOKEN_EXPRESS)) return null;\n  console.log(\"getUserInfo fired!\");\n  var user = {};\n  console.log(\"getUserInfo return started!\");\n  return function (dispatch) {\n    fetch('http://localhost:8080/api/user/me', {\n      method: 'get',\n      headers: {\n        \"Content-Type\": \"application/json\",\n        'Authorization': 'Bearer ' + localStorage.getItem(TOKEN_SPRING)\n      }\n    }).then(function (data) {\n      return data.json();\n    }).then(function (response) {\n      console.log('UserService getUserInfo: ', response);\n      user = {\n        type: restConstants.GET_USER_DATA,\n        id: response.id,\n        username: response.name,\n        email: \"XD\" // dispatch({\n        //     type: restConstants.GET_USER_DATA,\n        //     id: response.id,\n        //     username: response.name,\n        //     email: \"XD\"\n        // })\n\n      };\n    }).then(fetch('http://localhost:4000/graphql', {\n      method: 'post',\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: \"{\\n    \\\"query\\\": \\\"query {login(email: \\\\\\\"\".concat(email, \"\\\\\\\", password: \\\\\\\"\").concat(password, \"\\\\\\\"){token userId}}\\\"\\n}\")\n    }).then(function (response) {\n      return response.json();\n    }).then(function (data) {\n      console.log(\"GQL Login response\");\n      console.log(data.data.login.token);\n      console.log(data.data.login.userId); // response = response.json();\n\n      localStorage.setItem(TOKEN_EXPRESS, data.data.login.token);\n      dispatch({\n        type: restConstants.GET_USER_DATA,\n        id: user.id,\n        username: user.name,\n        email: user.email,\n        idExpress: data.data.login.userId\n      });\n    }));\n  };\n}\n\nfunction logout() {\n  localStorage.removeItem(TOKEN_SPRING);\n  localStorage.removeItem(TOKEN_EXPRESS);\n  localStorage.removeItem('token');\n  localStorage.removeItem('username');\n}","map":{"version":3,"sources":["/home/przemek/Data/Programowanie/PWr/ZPI/Teache/frontend/src/service/userService.js"],"names":["TOKEN_EXPRESS","TOKEN_SPRING","Alert","restConstants","userService","login","register","logout","email","password","localStorage","getItem","body","dispatch","fetch","method","headers","JSON","stringify","then","data","json","response","console","log","setItem","accessToken","getUserInfo","user","type","GET_USER_DATA","id","username","name","token","userId","idExpress","removeItem"],"mappings":"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","sourcesContent":["import {TOKEN_EXPRESS, TOKEN_SPRING} from \"../constraints\";\nimport Alert from \"react-s-alert\";\nimport {restConstants} from \"../constraints/restConstants\";\n\nexport const userService = {\n    login,\n    register,\n    logout\n};\n\nfunction login(email, password) {\n    if(localStorage.getItem(TOKEN_SPRING))\n        return\n\n    const body = {\n        email: email,\n        password: password\n    };\n    return dispatch => {\n        fetch(\"http://localhost:8080/api/auth/login\", {\n            method: \"post\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(body)\n        })\n            .then(data => data.json())\n            .then(response => {\n                console.log('UserService login: ');\n                console.log(response);\n                localStorage.setItem(TOKEN_SPRING, response.accessToken);\n                return dispatch(getUserInfo(email, password))\n            });\n    };\n}\n\nfunction register(body) {\n    if(localStorage.getItem(TOKEN_SPRING))\n        return null;\n\n    return dispatch => {\n        fetch(\"http://localhost:8080/api/auth/signup\", {\n            method: \"post\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(body)\n        })\n            .then(data => data.json())\n            .then(response => {\n                console.log('UserService register: ');\n                console.log(response);\n            });\n    };\n}\n\nfunction getUserInfo(email, password) {\n    if(!localStorage.getItem(TOKEN_SPRING) || localStorage.getItem(TOKEN_EXPRESS))\n        return null\n    console.log(\"getUserInfo fired!\");\n\n    let user = {};\n    console.log(\"getUserInfo return started!\");\n    return dispatch => {\n        fetch('http://localhost:8080/api/user/me', {\n            method: 'get',\n            headers: {\n                \"Content-Type\": \"application/json\",\n                'Authorization': 'Bearer ' + localStorage.getItem(TOKEN_SPRING)\n            }\n        })\n            .then(data => data.json())\n            .then(response => {\n                console.log('UserService getUserInfo: ', response);\n                user = {\n                    type: restConstants.GET_USER_DATA,\n                    id: response.id,\n                    username: response.name,\n                    email: \"XD\"\n                }\n                // dispatch({\n                //     type: restConstants.GET_USER_DATA,\n                //     id: response.id,\n                //     username: response.name,\n                //     email: \"XD\"\n                // })\n            }).then(fetch('http://localhost:4000/graphql', {\n            method: 'post',\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: `{\n    \"query\": \"query {login(email: \\\\\"${email}\\\\\", password: \\\\\"${password}\\\\\"){token userId}}\"\n}`,\n        }).then(response => response.json())\n            .then(data => {\n                console.log(\"GQL Login response\");\n                console.log(data.data.login.token);\n                console.log(data.data.login.userId);\n                // response = response.json();\n                localStorage.setItem(TOKEN_EXPRESS, data.data.login.token);\n                dispatch({\n                    type: restConstants.GET_USER_DATA,\n                    id: user.id,\n                    username: user.name,\n                    email: user.email,\n                    idExpress: data.data.login.userId\n                })\n            }))\n    }\n}\n\nfunction logout() {\n    localStorage.removeItem(TOKEN_SPRING);\n    localStorage.removeItem(TOKEN_EXPRESS);\n    localStorage.removeItem('token');\n    localStorage.removeItem('username');\n\n}\n"]},"metadata":{},"sourceType":"module"}