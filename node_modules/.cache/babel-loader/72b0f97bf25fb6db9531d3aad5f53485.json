{"ast":null,"code":"import { TOKEN_EXPRESS, TOKEN_SPRING } from \"../constraints\";\nimport Alert from \"react-s-alert\";\nimport { restConstants } from \"../constraints/restConstants\";\nimport { SPRING_URL, EXPRESS_URL } from \"../constants\";\nexport var userService = {\n  login: login,\n  register: register,\n  logout: logout\n};\n\nfunction login(email, password) {\n  var body = {\n    email: email,\n    password: password\n  };\n  return function (dispatch) {\n    fetch(SPRING_URL + \"/api/auth/login\", {\n      method: \"post\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(body)\n    }).then(function (data) {\n      return data.json();\n    }).then(function (response) {\n      console.log('UserService login: ');\n      console.log(response);\n      localStorage.setItem(TOKEN_SPRING, response.accessToken);\n      return dispatch(getUserInfo(email, password));\n    });\n  };\n}\n\nfunction register(body) {\n  return function (dispatch) {\n    fetch(SPRING_URL + \"/api/auth/signup\", {\n      method: \"post\",\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(body)\n    }).then(function (data) {\n      return data.json();\n    }).then(function (response) {\n      console.log('UserService register: ');\n      console.log(response);\n    });\n  };\n}\n\nfunction getUserInfo(email, password) {\n  console.log(\"getUserInfo fired!\");\n  var user = {};\n  console.log(\"getUserInfo return started!\");\n  return function (dispatch) {\n    fetch(SPRING_URL + '/api/user/me', {\n      method: 'get',\n      headers: {\n        \"Content-Type\": \"application/json\",\n        'Authorization': 'Bearer ' + localStorage.getItem(TOKEN_SPRING)\n      }\n    }).then(function (data) {\n      return data.json();\n    }).then(function (response) {\n      console.log('UserService getUserInfo: ', response);\n      user = {\n        type: restConstants.GET_USER_DATA,\n        id: response.id,\n        username: response.name,\n        email: \"XD\" // dispatch({\n        //     type: restConstants.GET_USER_DATA,\n        //     id: response.id,\n        //     username: response.name,\n        //     email: \"XD\"\n        // })\n\n      };\n    }).then(fetch(EXPRESS_URL + '/graphql', {\n      method: 'post',\n      headers: {\n        \"Content-Type\": \"application/json\"\n      },\n      body: \"{\\n    \\\"query\\\": \\\"query {login(email: \\\\\\\"\".concat(email, \"\\\\\\\", password: \\\\\\\"\").concat(password, \"\\\\\\\"){token userId}}\\\"\\n}\")\n    }).then(function (response) {\n      return response.json();\n    }).then(function (data) {\n      console.log(\"GQL Login response\");\n      console.log(data.data.login.token);\n      console.log(data.data.login.userId); // response = response.json();\n\n      localStorage.setItem(TOKEN_EXPRESS, data.data.login.token);\n      dispatch({\n        type: restConstants.GET_USER_DATA,\n        id: user.id,\n        username: user.name,\n        email: user.email,\n        idExpress: data.data.login.userId\n      });\n    }));\n  };\n}\n\nfunction logout() {\n  localStorage.removeItem(TOKEN_SPRING);\n  localStorage.removeItem(TOKEN_EXPRESS);\n  localStorage.removeItem('token');\n  localStorage.removeItem('username');\n}","map":{"version":3,"sources":["/home/przemek/Data/Programowanie/PWr/ZPI/Teache/src/service/userService.js"],"names":["TOKEN_EXPRESS","TOKEN_SPRING","Alert","restConstants","SPRING_URL","EXPRESS_URL","userService","login","register","logout","email","password","body","dispatch","fetch","method","headers","JSON","stringify","then","data","json","response","console","log","localStorage","setItem","accessToken","getUserInfo","user","getItem","type","GET_USER_DATA","id","username","name","token","userId","idExpress","removeItem"],"mappings":"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","sourcesContent":["import {TOKEN_EXPRESS, TOKEN_SPRING} from \"../constraints\";\nimport Alert from \"react-s-alert\";\nimport {restConstants} from \"../constraints/restConstants\";\nimport {SPRING_URL, EXPRESS_URL} from \"../constants\";\n\nexport const userService = {\n    login,\n    register,\n    logout\n};\n\nfunction login(email, password) {\n    const body = {\n        email: email,\n        password: password\n    };\n    return dispatch => {\n        fetch(SPRING_URL + \"/api/auth/login\", {\n            method: \"post\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(body)\n        })\n            .then(data => data.json())\n            .then(response => {\n                console.log('UserService login: ');\n                console.log(response);\n                localStorage.setItem(TOKEN_SPRING, response.accessToken);\n                return dispatch(getUserInfo(email, password))\n            });\n    };\n}\n\nfunction register(body) {\n    return dispatch => {\n        fetch(SPRING_URL + \"/api/auth/signup\", {\n            method: \"post\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(body)\n        })\n            .then(data => data.json())\n            .then(response => {\n                console.log('UserService register: ');\n                console.log(response);\n            });\n    };\n}\n\nfunction getUserInfo(email, password) {\n    console.log(\"getUserInfo fired!\");\n\n    let user = {};\n    console.log(\"getUserInfo return started!\");\n    return dispatch => {\n        fetch(SPRING_URL + '/api/user/me', {\n            method: 'get',\n            headers: {\n                \"Content-Type\": \"application/json\",\n                'Authorization': 'Bearer ' + localStorage.getItem(TOKEN_SPRING)\n            }\n        })\n            .then(data => data.json())\n            .then(response => {\n                console.log('UserService getUserInfo: ', response);\n                user = {\n                    type: restConstants.GET_USER_DATA,\n                    id: response.id,\n                    username: response.name,\n                    email: \"XD\"\n                }\n                // dispatch({\n                //     type: restConstants.GET_USER_DATA,\n                //     id: response.id,\n                //     username: response.name,\n                //     email: \"XD\"\n                // })\n            }).then(fetch(EXPRESS_URL + '/graphql', {\n            method: 'post',\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: `{\n    \"query\": \"query {login(email: \\\\\"${email}\\\\\", password: \\\\\"${password}\\\\\"){token userId}}\"\n}`,\n        }).then(response => response.json())\n            .then(data => {\n                console.log(\"GQL Login response\");\n                console.log(data.data.login.token);\n                console.log(data.data.login.userId);\n                // response = response.json();\n                localStorage.setItem(TOKEN_EXPRESS, data.data.login.token);\n                dispatch({\n                    type: restConstants.GET_USER_DATA,\n                    id: user.id,\n                    username: user.name,\n                    email: user.email,\n                    idExpress: data.data.login.userId\n                })\n            }))\n    }\n}\n\nfunction logout() {\n    localStorage.removeItem(TOKEN_SPRING);\n    localStorage.removeItem(TOKEN_EXPRESS);\n    localStorage.removeItem('token');\n    localStorage.removeItem('username');\n\n}\n"]},"metadata":{},"sourceType":"module"}