{"ast":null,"code":"import _classCallCheck from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _taggedTemplateLiteral from \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";\nvar _jsxFileName = \"/home/przemek/Data/Programowanie/PWr/ZPI/frontend/src/components/MainPage.js\";\n\nfunction _templateObject() {\n  var data = _taggedTemplateLiteral([\"\\n    position: absolute;\\n    top: 5%;\\n    left: 50%;\\n    width: 90%;\\n    height: 80%;\\n    transform: translate(-50%);\\n    display: grid;\\n    grid-gap: 4px;\"]);\n\n  _templateObject = function _templateObject() {\n    return data;\n  };\n\n  return data;\n}\n\nimport React, { Component } from \"react\";\nimport ChatGroup from './ChatGroup';\nimport bgPic from \"../assets/mntnFHD_compressed_cut.jpeg\";\nimport Message from './Message';\nimport { connect } from \"react-redux\";\nimport GroupsComponent from \"./GroupsComponent\";\nimport ChatComponent from \"./ChatComponent\";\nimport styled from 'styled-components';\nimport { DetailsComponent } from \"./DetailsComponent\";\nimport '../styles/mainPage.scss';\nimport { Messages } from \"../data/Messages\";\nimport { Mutation, Query } from 'react-apollo';\nimport gql from 'graphql-tag';\nimport AdvertsComponent from \"./AdvertsComponent\";\nimport TeacheCoin from \"../tokens/TeacheCoin\";\nimport { Eth } from \"web3-eth\";\nimport Web3 from \"web3\"; // const Page = styled.div`\n//     // width: 100%;\n//     // height: 910px;\n//     // background-image: url(${bgPic})\n//     `;\n\nvar Container = styled.div(_templateObject());\nvar styleOptCollapsed = {\n  gridTemplateColumns: '72px auto' // gridTemplateRows: '95%',\n\n};\nvar styleOptUnCollapsed = {\n  gridTemplateColumns: '72px auto 320px' // gridTemplateRows: '95%',\n\n};\n\nvar MainPage =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(MainPage, _Component);\n\n  function MainPage(props) {\n    var _this;\n\n    _classCallCheck(this, MainPage);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(MainPage).call(this, props));\n\n    _this.handleKeyPress = function (event) {\n      if (event.key === 'Enter') {\n        _this.handleSend();\n      }\n    };\n\n    _this.openMainItem = function () {\n      _this.setState({\n        mainItemActive: true,\n        activeConversation: null\n      });\n\n      console.log(\"Open Main Item\");\n    };\n\n    _this.groupChanged = function (id) {\n      console.log(\"group changed: \", id);\n\n      _this.setState({\n        activeConversation: id,\n        mainItemActive: false\n      });\n    };\n\n    _this.showDetails = function (id) {\n      console.log(id);\n    };\n\n    _this.findActive = function (conversation) {\n      var activeConversation = _this.state.activeConversation;\n      return conversation.id === activeConversation;\n    };\n\n    var _this$props = _this.props,\n        conversations = _this$props.conversations,\n        groups = _this$props.groups,\n        adverts = _this$props.adverts;\n    _this.state = {\n      inputMessage: '',\n      activeConversation: conversations[0].id,\n      conversations: conversations,\n      groups: groups,\n      mainItemActive: true,\n      width: 0,\n      isCollapsed: false,\n      userID: '5ca1c9a11c9d4400003e3590',\n      TeacheCoin: {\n        balance: 0,\n        providerName: \"Rinkeby\"\n      }\n    };\n    _this.isWeb3 = false;\n    _this.isWeb3Locked = false;\n    _this.token = null;\n    _this.updateWindowDimensions = _this.updateWindowDimensions.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.loadBalance = _this.loadBalance.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.checkWeb3Compatibility = _this.checkWeb3Compatibility.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(MainPage, [{\n    key: \"loadBalance\",\n    value: function loadBalance() {\n      var _this2 = this;\n\n      if (this.isWeb3) {\n        this.web3.eth.getCoinbase(function (error, coinbase) {\n          if (error) {\n            console.log(error);\n          } else {\n            var account = coinbase;\n            console.log(_this2.token);\n\n            _this2.token.balanceOf(coinbase, function (error, response) {\n              if (!error) {\n                var decimal = _this2.token.decimal;\n                var precision = '1e' + decimal;\n                var balance = response.c[0] / precision; // let name = this.token.name\n                // let symbol = this.token.symbol\n                // let icon = this.token.icon\n                // let abi = this.token.abi\n                // let address = this.token.address\n\n                balance = balance >= 0 ? balance : 0;\n                console.log(balance);\n              }\n            });\n          }\n        });\n      }\n    }\n  }, {\n    key: \"checkWeb3Compatibility\",\n    value: function checkWeb3Compatibility() {\n      var _this3 = this;\n\n      var web3 = new Web3();\n\n      if (window.ethereum) {\n        this.web3 = new Web3(window.ethereum);\n      } else if (typeof window.web3 !== 'undefined') {\n        this.web3 = new Web3(web3.currentProvider);\n      } else {\n        console.log(\"Non-etherum browser\");\n      }\n\n      if (this.web3) {\n        this.isWeb3 = true;\n        this.token = this.web3.eth.Contract(TeacheCoin.abi, TeacheCoin.address);\n        console.log(\"Token: \" + this.token);\n        web3.eth.getCoinbase(function (error, coinbase) {\n          if (error || coinbase === null) {\n            _this3.isWeb3Locked = true;\n          } else {\n            _this3.isWeb3Locked = false;\n          }\n        });\n      } else {\n        this.isWeb3 = false;\n      }\n\n      this.loadBalance();\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.updateWindowDimensions();\n      window.addEventListener('resize', this.updateWindowDimensions);\n      window.addEventListener('load', this.checkWeb3Compatibility);\n    }\n  }, {\n    key: \"componentWillMount\",\n    value: function componentWillMount() {\n      window.removeEventListener('resize', this.updateWindowDimensions);\n    }\n  }, {\n    key: \"updateWindowDimensions\",\n    value: function updateWindowDimensions() {\n      var w = window.innerWidth;\n      this.setState({\n        width: w,\n        isCollapsed: w <= 960\n      });\n    }\n  }, {\n    key: \"handleSend\",\n    value: function handleSend() {\n      var inputMessage = this.state.inputMessage;\n\n      if (inputMessage) {\n        console.log('send message');\n        this.setState(function (prevState) {\n          prevState.inputMessage = '';\n          return prevState;\n        });\n      }\n\n      console.log(\"sending message\");\n      fetch('http://localhost:4050/graphql', {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          query: \"mutation($message: MessageInput!){ addMessage(message: $message){ content id } } \",\n          variables: \"{\\\"message\\\": {\\\"id_conversation\\\": \\\"5ca3a1ef1cbb8b36dbb6adf0\\\", \\\"id_sender\\\": \\\"\".concat(this.state.userID, \"\\\", \\\"content\\\": \\\"\").concat(inputMessage, \"\\\"}}\")\n        })\n      }); // `{ \"message\": { \"id_conversation\": \"5ca387903805a07cd4526d77\", \"id_sender\": \"${this.state.userID}\", \"content\": \"XD\" } }`\n\n      {\n        /*<Mutation mutation={gql`*/\n      }\n      {\n        /*        mutation ($content:String!,$id_conv:String!,$id_sender:String!){*/\n      }\n      {\n        /*          sendMessage(content: $content, id_conversation: $id_conv, id_sender: $id_sender) {*/\n      }\n      {\n        /*            id*/\n      }\n      {\n        /*          }*/\n      }\n      {\n        /*        }`*/\n      }\n      {\n        /*}>*/\n      }\n      {\n        /*    {(sendMessage, {data}) => (*/\n      }\n      {\n        /*        sendMessage({*/\n      }\n      {\n        /*                variables: {*/\n      }\n      {\n        /*                    content: \"inputMessage\",*/\n      }\n      {\n        /*                    id_sender: \"this.state.userID\",*/\n      }\n      {\n        /*                    id_conv: '5c98f6721c9d440000626e2e'*/\n      }\n      {\n        /*                }*/\n      }\n      {\n        /*            }*/\n      }\n      {\n        /*        )*/\n      }\n      {\n        /*    )}*/\n      }\n      {}\n      /*</Mutation>*/\n      // mutation\n      // sendMessage(\n      //     content: \"A dziękuję\",\n      //     id_conversation: \"5c98f6721c9d440000626e2e\",\n      //     id_sender: \"5ca1c9a11c9d4400003e3590\") {\n      //     content\n      // }\n    }\n  }, {\n    key: \"handleChangeInput\",\n    value: function handleChangeInput(event) {\n      var value = event.target.value;\n      this.setState({\n        inputMessage: value\n      });\n      console.log(\"input\");\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      var _this$state = this.state,\n          conversations = _this$state.conversations,\n          userID = _this$state.userID,\n          groups = _this$state.groups,\n          activeConversation = _this$state.activeConversation,\n          isCollapsed = _this$state.isCollapsed,\n          mainItemActive = _this$state.mainItemActive,\n          inputMessage = _this$state.inputMessage;\n      var activeConvName = mainItemActive ? [] : conversations.find(this.findActive).name;\n      var messagesList = conversations.length !== 0 && conversations.find(this.findActive) ? conversations.find(this.findActive).messages.map(function (message) {\n        return React.createElement(Message, {\n          message: message.inputMessage,\n          id: message.id,\n          key: message.id,\n          handleOver: _this4.showDetails // isActive={message.id_sender === userID}\n          ,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 278\n          },\n          __self: this\n        });\n      }) : [];\n      var groupsCompList = groups.map(function (chat) {\n        return React.createElement(ChatGroup, {\n          key: chat.id,\n          id: chat.id,\n          url: chat.avatar,\n          onClick: _this4.groupChanged,\n          active: chat.id === activeConversation,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 289\n          },\n          __self: this\n        });\n      });\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 297\n        },\n        __self: this\n      }, React.createElement(Container, {\n        style: isCollapsed ? styleOptCollapsed : styleOptUnCollapsed,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 298\n        },\n        __self: this\n      }, React.createElement(GroupsComponent, {\n        mainItemActive: mainItemActive,\n        openMainItem: this.openMainItem,\n        list: groupsCompList,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 300\n        },\n        __self: this\n      }), this.state.mainItemActive ? React.createElement(AdvertsComponent, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 306\n        },\n        __self: this\n      }) : React.createElement(ChatComponent, {\n        handleOver: this.showDetails,\n        userId: userID,\n        conversationName: activeConvName,\n        messages: messagesList,\n        inputMessage: inputMessage,\n        onChange: function onChange(event) {\n          return _this4.handleChangeInput(event);\n        },\n        onKeyPress: this.handleKeyPress,\n        onClick: function onClick() {\n          return _this4.handleSend();\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 307\n        },\n        __self: this\n      }), !isCollapsed ? React.createElement(DetailsComponent, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 317\n        },\n        __self: this\n      }) : null));\n    }\n  }]);\n\n  return MainPage;\n}(Component);\n\nfunction mapStateToProps(state) {\n  var _state$chatReducer = state.chatReducer,\n      conversations = _state$chatReducer.conversations,\n      groups = _state$chatReducer.groups;\n  var adverts = state.advertReducer.adverts;\n  return {\n    conversations: conversations,\n    groups: groups,\n    adverts: adverts\n  };\n}\n\nexport default MainPage = connect(mapStateToProps)(MainPage);","map":{"version":3,"sources":["/home/przemek/Data/Programowanie/PWr/ZPI/frontend/src/components/MainPage.js"],"names":["React","Component","ChatGroup","bgPic","Message","connect","GroupsComponent","ChatComponent","styled","DetailsComponent","Messages","Mutation","Query","gql","AdvertsComponent","TeacheCoin","Eth","Web3","Container","div","styleOptCollapsed","gridTemplateColumns","styleOptUnCollapsed","MainPage","props","handleKeyPress","event","key","handleSend","openMainItem","setState","mainItemActive","activeConversation","console","log","groupChanged","id","showDetails","findActive","conversation","state","conversations","groups","adverts","inputMessage","width","isCollapsed","userID","balance","providerName","isWeb3","isWeb3Locked","token","updateWindowDimensions","bind","loadBalance","checkWeb3Compatibility","web3","eth","getCoinbase","error","coinbase","account","balanceOf","response","decimal","precision","c","window","ethereum","currentProvider","Contract","abi","address","addEventListener","removeEventListener","w","innerWidth","prevState","fetch","method","headers","body","JSON","stringify","query","variables","value","target","activeConvName","find","name","messagesList","length","messages","map","message","groupsCompList","chat","avatar","handleChangeInput","mapStateToProps","chatReducer","advertReducer"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\"\nimport ChatGroup from './ChatGroup'\nimport bgPic from \"../assets/mntnFHD_compressed_cut.jpeg\";\nimport Message from './Message'\n\nimport {connect} from \"react-redux\";\nimport GroupsComponent from \"./GroupsComponent\";\nimport ChatComponent from \"./ChatComponent\";\nimport styled from 'styled-components'\nimport {DetailsComponent} from \"./DetailsComponent\";\nimport '../styles/mainPage.scss'\nimport {Messages} from \"../data/Messages\";\nimport {Mutation, Query} from 'react-apollo'\nimport gql from 'graphql-tag'\nimport AdvertsComponent from \"./AdvertsComponent\";\n\nimport TeacheCoin from \"../tokens/TeacheCoin\";\nimport { Eth } from \"web3-eth\";\nimport Web3 from \"web3\";\n\n// const Page = styled.div`\n//     // width: 100%;\n//     // height: 910px;\n//     // background-image: url(${bgPic})\n//     `;\n\nconst Container = styled.div`\n    position: absolute;\n    top: 5%;\n    left: 50%;\n    width: 90%;\n    height: 80%;\n    transform: translate(-50%);\n    display: grid;\n    grid-gap: 4px;`;\n\nconst styleOptCollapsed = {\n    gridTemplateColumns: '72px auto',\n    // gridTemplateRows: '95%',\n};\n\nconst styleOptUnCollapsed = {\n    gridTemplateColumns: '72px auto 320px',\n    // gridTemplateRows: '95%',\n};\n\nclass MainPage extends Component {\n\n    constructor(props) {\n        super(props);\n        const {conversations, groups, adverts} = this.props;\n        \n        this.state = {\n            inputMessage: '',\n            activeConversation: conversations[0].id,\n            conversations: conversations,\n            groups: groups,\n            mainItemActive: true,\n            width: 0,\n            isCollapsed: false,\n            userID: '5ca1c9a11c9d4400003e3590',\n            TeacheCoin: {\n                balance: 0,\n                providerName: \"Rinkeby\"\n            }\n        };\n\n        this.isWeb3 = false;\n        this.isWeb3Locked = false;\n        this.token = null;\n\n        this.updateWindowDimensions = this.updateWindowDimensions.bind(this)\n        this.loadBalance = this.loadBalance.bind(this)\n        this.checkWeb3Compatibility = this.checkWeb3Compatibility.bind(this)\n    }\n\n    loadBalance() {\n        if(this.isWeb3) {\n            this.web3.eth.getCoinbase((error, coinbase) => {\n                if(error) {\n                    console.log(error)\n                } else {\n                    let account = coinbase\n\n                    console.log(this.token)\n                    this.token.balanceOf(coinbase, (error, response) => {\n                        if(!error) {\n                            let decimal = this.token.decimal\n                            let precision = '1e' + decimal\n                            let balance = response.c[0] / precision\n                            // let name = this.token.name\n                            // let symbol = this.token.symbol\n                            // let icon = this.token.icon\n                            // let abi = this.token.abi\n                            // let address = this.token.address\n\n                            balance = balance >= 0 ? balance : 0\n\n                            console.log(balance)\n                        }\n                    })\n                }\n            })\n        }\n    }\n\n    checkWeb3Compatibility () {\n        let web3 = new Web3()\n        if(window.ethereum) {\n            this.web3 = new Web3(window.ethereum)\n        } else if (typeof window.web3 !== 'undefined') {\n            this.web3 = new Web3(web3.currentProvider)\n        } else {\n            console.log(\"Non-etherum browser\")\n        }\n\n        if(this.web3) {\n            this.isWeb3 = true;\n            this.token = this.web3.eth.Contract(TeacheCoin.abi, TeacheCoin.address)\n            console.log(\"Token: \" + this.token)\n            web3.eth.getCoinbase((error, coinbase) => {\n                if(error || coinbase === null) {\n                    this.isWeb3Locked = true;\n                } else {\n                    this.isWeb3Locked = false;\n                }\n            })\n        } else {\n            this.isWeb3 = false;\n        }\n\n        this.loadBalance()\n    }\n\n    componentDidMount() {\n        this.updateWindowDimensions();\n        window.addEventListener('resize', this.updateWindowDimensions)\n        window.addEventListener('load', this.checkWeb3Compatibility)\n    }\n\n    componentWillMount() {\n        window.removeEventListener('resize', this.updateWindowDimensions)\n    }\n\n    updateWindowDimensions() {\n        const w = window.innerWidth;\n        this.setState({\n            width: w,\n            isCollapsed: w <= 960\n        });\n    }\n\n    handleSend() {\n        const {inputMessage} = this.state;\n        if (inputMessage) {\n            console.log('send message');\n            this.setState(prevState => {\n                prevState.inputMessage = '';\n                return prevState\n            });\n        }\n        console.log(\"sending message\");\n        fetch('http://localhost:4050/graphql', {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                query: `mutation($message: MessageInput!){ addMessage(message: $message){ content id } } `,\n                variables: `{\"message\": {\"id_conversation\": \"5ca3a1ef1cbb8b36dbb6adf0\", \"id_sender\": \"${this.state.userID}\", \"content\": \"${inputMessage}\"}}`\n            })\n        });\n        // `{ \"message\": { \"id_conversation\": \"5ca387903805a07cd4526d77\", \"id_sender\": \"${this.state.userID}\", \"content\": \"XD\" } }`\n\n\n        {/*<Mutation mutation={gql`*/\n        }\n        {/*        mutation ($content:String!,$id_conv:String!,$id_sender:String!){*/\n        }\n        {/*          sendMessage(content: $content, id_conversation: $id_conv, id_sender: $id_sender) {*/\n        }\n        {/*            id*/\n        }\n        {/*          }*/\n        }\n        {/*        }`*/\n        }\n        {/*}>*/\n        }\n        {/*    {(sendMessage, {data}) => (*/\n        }\n        {/*        sendMessage({*/\n        }\n        {/*                variables: {*/\n        }\n        {/*                    content: \"inputMessage\",*/\n        }\n        {/*                    id_sender: \"this.state.userID\",*/\n        }\n        {/*                    id_conv: '5c98f6721c9d440000626e2e'*/\n        }\n        {/*                }*/\n        }\n        {/*            }*/\n        }\n        {/*        )*/\n        }\n        {/*    )}*/\n        }\n        {/*</Mutation>*/\n        }\n\n        // mutation\n        // sendMessage(\n        //     content: \"A dziękuję\",\n        //     id_conversation: \"5c98f6721c9d440000626e2e\",\n        //     id_sender: \"5ca1c9a11c9d4400003e3590\") {\n        //     content\n        // }\n\n    }\n\n    handleKeyPress = (event) => {\n        if (event.key === 'Enter') {\n            this.handleSend();\n        }\n    };\n\n    handleChangeInput(event) {\n        const {value} = event.target;\n        this.setState({\n            inputMessage: value\n        });\n        console.log(\"input\")\n    }\n\n    openMainItem = () => {\n        this.setState({\n            mainItemActive: true,\n            activeConversation: null\n        });\n        console.log(\"Open Main Item\")\n    };\n\n\n    groupChanged = (id) => {\n        console.log(\"group changed: \", id);\n        this.setState({\n            activeConversation: id,\n            mainItemActive: false\n        });\n    };\n\n    showDetails = (id) => {\n        console.log(id);\n    };\n\n    findActive = (conversation) => {\n        const {activeConversation} = this.state;\n        return conversation.id === activeConversation\n    };\n\n    render() {\n        const {\n            conversations,\n            userID,\n            groups,\n            activeConversation,\n            isCollapsed,\n            mainItemActive,\n            inputMessage,\n        } = this.state;\n\n        const activeConvName = mainItemActive ? [] : conversations.find(this.findActive).name;\n\n        const messagesList = conversations.length !== 0 && conversations.find(this.findActive)\n            ? conversations.find(this.findActive).messages.map(message =>\n                <Message\n                    message={message.inputMessage}\n                    id={message.id}\n                    key={message.id}\n                    handleOver={this.showDetails}\n                    // isActive={message.id_sender === userID}\n                />)\n            : [];\n\n        const groupsCompList =\n            groups.map(chat =>\n                <ChatGroup\n                    key={chat.id}\n                    id={chat.id}\n                    url={chat.avatar}\n                    onClick={this.groupChanged}\n                    active={chat.id === activeConversation}/>);\n\n        return (\n            <div>\n                <Container\n                    style={isCollapsed ? styleOptCollapsed : styleOptUnCollapsed}>\n                    <GroupsComponent\n                        mainItemActive={mainItemActive}\n                        openMainItem={this.openMainItem}\n                        list={groupsCompList}/>\n                {/**/}\n                    {this.state.mainItemActive\n                        ? <AdvertsComponent />\n                        : <ChatComponent\n                        handleOver={this.showDetails}\n                        userId={userID}\n                        conversationName={activeConvName}\n                        messages={messagesList}\n                        inputMessage={inputMessage}\n                        onChange={event => this.handleChangeInput(event)}\n                        onKeyPress={this.handleKeyPress}\n                        onClick={() => this.handleSend()}/>\n                    }\n                    {!isCollapsed ? <DetailsComponent/> : null}\n                </Container>\n            </div>\n        )\n    }\n}\n\nfunction mapStateToProps(state) {\n    const {conversations, groups} = state.chatReducer;\n    const {adverts} = state.advertReducer;\n    return {conversations, groups, adverts};\n}\n\nexport default MainPage = connect(mapStateToProps)(MainPage);\n"]},"metadata":{},"sourceType":"module"}